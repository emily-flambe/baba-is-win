---
import type { MuseumProject, ProjectCategory } from '../../lib/github/types.js';
import { PROJECT_CATEGORIES } from '../../lib/github/api.js';

export interface Props {
  project: MuseumProject;
  featured?: boolean;
  size?: 'small' | 'medium' | 'large';
}

const { project, featured = false, size = 'medium' } = Astro.props;
const category = PROJECT_CATEGORIES[project.category];
const updatedDate = new Date(project.updatedAt).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric'
});

// Get emoji from category config, fallback to generic icon
const categoryEmoji = category?.icon || 'ðŸ“±';
---

<article 
  class={`project-card ${size} ${featured ? 'featured' : ''}`}
  data-category={project.category}
  data-language={project.language || 'unknown'}
>
  <!-- Image Container with 16:10 Aspect Ratio -->
  <div class="project-image" data-category={project.category}>
    <div class="image-placeholder">
      <span class="category-icon">{categoryEmoji}</span>
    </div>
  </div>

  <!-- Card Content -->
  <div class="project-content">
    <div class="project-header">
      <h3 class="project-title">{project.displayName}</h3>
    </div>
    
    <p class="project-description">{project.description}</p>
    
    <!-- Tech Badges -->
    <div class="project-badges">
      <span 
        class="tech-badge category-badge"
        style={category ? `
          background: color-mix(in srgb, ${category.color} 15%, transparent);
          color: ${category.color};
          border-color: color-mix(in srgb, ${category.color} 30%, transparent);
        ` : ''}
      >
        {category?.name || 'Project'}
      </span>
      {project.language && (
        <span class="tech-badge">{project.language}</span>
      )}
      {project.topics.slice(0, 2).map(topic => (
        <span class="tech-badge">{topic}</span>
      ))}
    </div>
  </div>

  <!-- Card Footer -->
  <div class="project-footer">
    <div class="project-links">
      <a 
        href={project.githubUrl} 
        class="project-link"
        target="_blank"
        rel="noopener noreferrer"
        title="View source code"
      >
        <span>GitHub</span>
      </a>
      {project.demoUrl ? (
        <a 
          href={project.demoUrl} 
          class="project-link demo"
          target="_blank"
          rel="noopener noreferrer"
          title="View live demo"
        >
          <span>Live Demo</span>
        </a>
      ) : (
        <span class="project-link demo disabled">
          <span>Demo</span>
        </span>
      )}
    </div>
    
    <div class="project-updated">
      <span class="updated-label">Updated:</span>
      <span class="updated-date">{updatedDate}</span>
    </div>
  </div>
</article>

<style>
  /* Museum Design System Variables */
  :root {
    --museum-primary: #2a4d3a;
    --museum-secondary: #f7f3e9;
    --museum-accent: #d4af37;
    --museum-text: #1a1a1a;
    --museum-muted: #6b7280;
    
    --museum-bg-primary: #ffffff;
    --museum-bg-secondary: #f8fafc;
    --museum-bg-tertiary: #f1f5f9;
    --museum-border: #e2e8f0;
    --museum-border-hover: #cbd5e1;
    
    --museum-success: #059669;
    --museum-warning: #f59e0b;
    --museum-error: #dc2626;
    --museum-info: #3b82f6;
    
    --museum-space-xs: 0.25rem;
    --museum-space-sm: 0.5rem;
    --museum-space-md: 1rem;
    --museum-space-lg: 1.5rem;
    --museum-space-xl: 2rem;
    
    --museum-text-xs: 0.75rem;
    --museum-text-sm: 0.875rem;
    --museum-text-base: 1rem;
    --museum-text-lg: 1.125rem;
    --museum-text-xl: 1.25rem;
    
    --museum-shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --museum-shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    
    --museum-radius-sm: 0.375rem;
    --museum-radius-md: 0.5rem;
    --museum-radius-lg: 0.75rem;
    --museum-radius-xl: 1rem;
    
    --museum-transition-base: 0.2s ease;
  }

  /* Dark Theme Overrides */
  @media (prefers-color-scheme: dark) {
    :root {
      --museum-bg-primary: #1e293b;
      --museum-bg-secondary: #334155;
      --museum-bg-tertiary: #475569;
      --museum-text: #f8fafc;
      --museum-muted: #94a3b8;
      --museum-border: #475569;
      --museum-border-hover: #64748b;
      --museum-secondary: #1e293b;
    }
  }

  /* Project Card with Modern Design */
  .project-card {
    background: var(--museum-bg-primary);
    border: 1px solid var(--museum-border);
    border-radius: var(--museum-radius-xl);
    box-shadow: var(--museum-shadow-card);
    transition: all var(--museum-transition-base);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .project-card:hover {
    border-color: var(--museum-border-hover);
  }

  /* Image Container with 16:10 Aspect Ratio */
  .project-image {
    aspect-ratio: 16 / 10;
    position: relative;
    overflow: hidden;
    border-bottom: 1px solid var(--museum-border);
    background: linear-gradient(135deg, var(--museum-bg-secondary) 0%, var(--museum-bg-tertiary) 100%);
    background-size: 200% 100%;
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }

  .image-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .image-placeholder::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 60px;
    background: var(--museum-primary);
    border-radius: 50%;
    opacity: 0.1;
  }

  .category-icon {
    font-size: 2rem;
    opacity: 0.3;
    z-index: 1;
  }

  /* Card Content */
  .project-content {
    padding: var(--museum-space-lg);
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .project-header {
    margin-bottom: var(--museum-space-md);
  }

  .project-title {
    font-size: var(--museum-text-xl);
    font-weight: 700;
    color: var(--museum-text);
    margin: 0 0 var(--museum-space-sm) 0;
    line-height: 1.3;
  }

  .project-description {
    font-size: var(--museum-text-sm);
    color: var(--museum-muted);
    line-height: 1.6;
    flex: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin: 0;
  }

  /* Tech Badges */
  .project-badges {
    margin-top: var(--museum-space-md);
    display: flex;
    flex-wrap: wrap;
    gap: var(--museum-space-sm);
  }

  .tech-badge {
    display: inline-flex;
    align-items: center;
    padding: var(--museum-space-xs) var(--museum-space-sm);
    background: var(--museum-bg-secondary);
    border: 1px solid var(--museum-border);
    border-radius: var(--museum-radius-sm);
    font-size: var(--museum-text-xs);
    font-weight: 500;
    color: var(--museum-text);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* Category badge gets color from inline style */
  .category-badge {
    /* Color will be set via inline style from config */
  }

  /* Card Footer */
  .project-footer {
    padding: var(--museum-space-md) var(--museum-space-lg);
    border-top: 1px solid var(--museum-border);
    background: var(--museum-bg-secondary);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .project-links {
    display: flex;
    gap: var(--museum-space-sm);
  }

  .project-link {
    display: inline-flex;
    align-items: center;
    gap: var(--museum-space-xs);
    padding: var(--museum-space-xs) var(--museum-space-sm);
    background: var(--museum-primary);
    color: white;
    text-decoration: none;
    border-radius: var(--museum-radius-sm);
    font-size: var(--museum-text-xs);
    font-weight: 500;
    transition: all var(--museum-transition-base);
    border: none;
  }

  .project-link:hover {
    background: color-mix(in srgb, var(--museum-primary) 85%, black);
    transform: translateY(-1px);
  }

  .project-link.demo {
    background: var(--museum-accent);
  }

  .project-link.demo:hover {
    background: color-mix(in srgb, var(--museum-accent) 85%, black);
  }

  .project-link.disabled {
    background: var(--museum-muted);
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  .project-updated {
    display: flex;
    align-items: center;
    gap: var(--museum-space-xs);
    font-size: var(--museum-text-xs);
    color: var(--museum-muted);
  }

  .updated-label {
    font-weight: 500;
  }

  .updated-date {
    font-variant-numeric: tabular-nums;
  }

  /* Mobile Responsive */
  @media (max-width: 480px) {
    .project-content {
      padding: var(--museum-space-md);
    }
    
    .project-footer {
      padding: var(--museum-space-sm) var(--museum-space-md);
      flex-direction: column;
      gap: var(--museum-space-sm);
      align-items: flex-start;
    }
    
    .project-links {
      width: 100%;
      justify-content: flex-start;
    }
  }

  /* Accessibility Improvements */
  @media (prefers-reduced-motion: reduce) {
    .project-card,
    .project-link {
      transition: none;
    }
    
    .project-image {
      animation: none;
    }
    
    .project-link:hover {
      transform: none;
    }
  }

  /* Focus Styles */
  .project-link:focus-visible {
    outline: 2px dashed var(--museum-primary);
    outline-offset: 2px;
  }
</style>